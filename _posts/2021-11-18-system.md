---
layout: post
title: "操作系统知识点总结"
date: 2021-11-18
tag: 操作系统
--- 

## 进程和线程

### 进程

**进程是资源分配的基本单位**

**进程控制块**描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指对 PCB 的操作

下图是 4 个程序创建了 4 个进程，这四个进程可以**并发执行**

![Image](https://pic4.zhimg.com/80/v2-6ff7d48175b5415d2ceb70e0401a40de.png)

### 线程

**线程是独立调度的基本单位**

一个进程中可以有多个线程，他们共享进程资源

网易云和浏览器是两个进程，浏览器进程里面可以有多个线程，比如 HTTP 请求线程，事件响应线程，渲染线程等，线程的并发执行使得在浏览器中点击一个新链接从而发起 HTTP 请求时，还可以相应其他线程

### 区别

1. **拥有资源**

进程是资源调度的基本单位，但是线程不拥有资源，线程可以访问隶属于该进程的资源

2. **调度**

线程是独立调度的基本单位。在同一进程中，线程的切换不会引起进程切换，从一个进程的线程切换到另一个进程的线程时，会引发线程切换

3. **系统开销**

由于创建或撤销进程时，系统都要为其分配或回收资源（内存空间，I/O等），所付出的开销远大于创建或撤销线程时的开销。

在进行进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换只需保存和设置少量寄存器内容，开销很小


4. **通信**

线程间可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助 IPC（进程间通信）

### 线程通信

1. 消息队列
2. 利用系统提供的事件，信号等通知机制
3. 通过管道
   
4. 套接字
   
> 等待唤醒机制（wait(), notify()）：在一个线程进行规定操作后，就进入等待状态，等待其他线程执行完他们的指定代码过后，再将其唤醒


### 进程通信

1. 管道
2. FIFO
3. 消息队列
4. 信号量
5. 共享存储
   允许多个进程共享一个给定的存储区，这样数据不需要在进程之间复制，所以这是最快的一种 IPC

   需要使用信号量来同步对共享存储的访问
   
   多个进程可以将同一个文件映射到他们的地址空间从而实现共享内存

6. 套接字
   用于不同机器间的进程通信

### 进程之间共享内存

![Image](https://pic4.zhimg.com/80/v2-b2344e2eccb92776358c854178849d3b.png)

共享内存是在内存中单独开辟的一段内存空间，这段内存空间有自己的数据结构，包括访问权限、大小、和最近访问的时间等

两个进程在使用此共享内存空间的时候，需要在进程地址空间与共享内存空间之间建立联系，即把共享内存空间挂载到进程中

在使用完毕后，需要调用 shmdt() 函数将其与当前进程分离

>  如何查看哪些进程在使用共享内存
> 
> 使用ipcs命令的 -m(内存) 和 -p（进程）选项

### 进程线程切换的代价